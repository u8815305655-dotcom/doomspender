<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Munka√≥ra</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --accent:#00b3a4;        /* t√ºrkiz */
      --accent2:#7c3aed;       /* lila */
      --good:#16a34a;          /* z√∂ld */
      --bad:#dc2626;           /* piros */
      --ink:#0f172a;
      --glass: rgba(255,255,255,.6);
    }
    html,body{height:100%}
    body{
      background:
        radial-gradient(1200px 700px at -10% -10%, #e0f7f5 0%, transparent 60%),
        radial-gradient(1100px 650px at 110% 10%, #efe7ff 0%, transparent 55%),
        linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--ink);
    }
    .glass{
      background: var(--glass);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(15,23,42,.08);
      border:1px solid rgba(255,255,255,.55);
    }
    .card{
      border-radius: 18px;
      padding: 18px;
      background: white;
      box-shadow: 0 16px 40px rgba(2,6,23,.08);
      border:1px solid rgba(2,6,23,.06);
    }
    .btn{
      border-radius: 9999px;
      padding: 12px 16px;
      font-weight: 700;
      transition: transform .06s ease, box-shadow .2s ease, filter .2s ease;
      box-shadow: 0 8px 18px rgba(2,6,23,.06);
    }
    .btn:active{ transform: translateY(1px) scale(.99) }
    .btn-accent{ background: linear-gradient(135deg, var(--accent), #04c7b6); color:#fff; }
    .btn-accent:hover{ filter: brightness(1.05); }
    .btn-secondary{ background:#eef2ff; color:#3730a3; }
    .btn-yellow{ background: linear-gradient(135deg, #ffd166, #ffec99); color:#111827; }
    .btn-good{ background: linear-gradient(135deg, var(--good), #34d399); color:#fff; }
    .btn-bad{ background: linear-gradient(135deg, var(--bad), #ef4444); color:#fff; }
    .input{
      width: 100%;
      background:#f3f4f6;
      border-radius: 14px;
      padding: 12px 14px;
      outline: none;
      border:1px solid transparent;
      transition: border-color .15s ease, background .15s ease;
    }
    .input:focus{ border-color:#93c5fd; background:#ffffff }
    .title{
      font-size: 26px;
      line-height: 1.15;
      font-weight: 800;
      letter-spacing: -.01em;
    }
    .sub{ color:#475569 }
    .chip{
      padding:6px 10px; border-radius:9999px; background:#f1f5f9; font-size:12px; color:#334155
    }
    .floating{ animation: floaty 6s ease-in-out infinite; }
    @keyframes floaty{ 0%{transform:translateY(0)} 50%{transform:translateY(-6px)} 100%{transform:translateY(0)} }
    .stat{
      border-radius:16px; padding:12px; background:linear-gradient(180deg,#ffffff, #f8fafc);
      border:1px solid #eef2ff; box-shadow:0 8px 24px rgba(2,6,23,.06)
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

  <!-- Wrap -->
  <main class="w-full max-w-sm space-y-4">

    <!-- Top bar -->
    <div class="glass rounded-2xl p-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 rounded-xl"
             style="background:linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%); box-shadow:0 6px 16px rgba(124,58,237,.25)"></div>
        <strong id="brandTitle">Munka√≥ra</strong>
      </div>
      <div class="flex items-center gap-2">
        <button id="goCalc" class="chip">Sz√°mol√≥</button>
        <button id="goResults" class="chip">Lista</button>
        <button id="goProfile" class="chip">Profil</button>
      </div>
    </div>

    <!-- WELCOME -->
    <section id="screen-welcome" class="card">
      <div class="flex flex-col items-center text-center gap-3">
        <h1 class="title">Kontextus a k√∂lt√©seid f√∂l√© üí∏</h1>
        <p class="sub">Sz√°mold ki, h√°ny munka√≥r√°dba ker√ºlne egy term√©k ‚Äì √©s d√∂nts tudatosabban.</p>
        <div class="w-full h-28 rounded-2xl floating"
             style="background:
                radial-gradient(200px 120px at 25% 30%, rgba(0,179,164,.25), transparent 60%),
                radial-gradient(220px 140px at 75% 20%, rgba(124,58,237,.18), transparent 55%),
                linear-gradient(180deg, #fff, #f8fafc);"></div>
        <button id="startBtn" class="btn btn-accent w-full">Kezdj√ºk</button>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="screen-profile" class="card hidden">
      <h2 class="title mb-2">Profil be√°ll√≠t√°s</h2>
      <p class="sub mb-3 text-sm">N√©v, √©letkor, nett√≥ b√©r √©s heti munka√≥r√°k alapj√°n sz√°molunk. K√©s≈ëbb b√°rmikor m√≥dos√≠thatod.</p>

      <label class="block text-sm font-semibold mb-1">Becen√©v</label>
      <input id="nick" type="text" class="input mb-3" placeholder="pl. Bence">

      <label class="block text-sm font-semibold mb-1">√âletkor</label>
      <input id="age" type="number" inputmode="numeric" class="input mb-3" placeholder="pl. 28">

      <label class="block text-sm font-semibold mb-1">Nett√≥ havi fizet√©s (Ft)</label>
      <input id="salary" type="number" inputmode="numeric" class="input mb-3" placeholder="pl. 420000">

      <label class="block text-sm font-semibold mb-1">Heti munka√≥r√°k</label>
      <input id="hours" type="number" inputmode="numeric" class="input mb-4" placeholder="pl. 40">

      <div class="flex gap-2">
        <button id="saveProfile" class="btn btn-accent flex-1">Ment√©s</button>
        <button id="cancelProfile" class="btn btn-secondary flex-1">M√©gse</button>
      </div>
    </section>

    <!-- CALCULATOR -->
    <section id="screen-calc" class="card hidden">
      <div class="flex items-center justify-between mb-2">
        <h2 class="title">√öj sz√°m√≠t√°s</h2>
        <span id="helloNick" class="text-sm text-slate-500"></span>
      </div>
      <p class="sub text-sm mb-3">Add meg a term√©ket √©s az √°r√°t.</p>

      <label class="block text-sm font-semibold mb-1">Term√©k neve</label>
      <input id="productName" type="text" class="input mb-3" placeholder="pl. iPhone 15">

      <label class="block text-sm font-semibold mb-1">Term√©k √°ra (Ft)</label>
      <input id="productPrice" type="number" inputmode="numeric" class="input mb-4" placeholder="pl. 299000">

      <button id="calculateBtn" class="btn btn-yellow w-full mb-4">Kisz√°molom</button>

      <div id="calcBox" class="hidden rounded-2xl p-4"
        style="background:linear-gradient(145deg, rgba(255,255,255,.9), rgba(250,250,255,.9)); border:1px solid #eef2ff">
        <p id="workResult" class="font-semibold text-center"></p>
        <p id="workSub" class="text-center text-sm text-slate-500 mt-1"></p>

        <div class="grid grid-cols-2 gap-2 mt-4">
          <button id="saveBtn" class="btn btn-good">üíö Megsp√≥rolom</button>
          <button id="buyBtn" class="btn btn-bad">‚ù§Ô∏è Megveszem</button>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="screen-results" class="card hidden">
      <div class="flex items-center justify-between mb-2">
        <h2 class="title">Eredm√©nyek</h2>
        <button id="clearList" class="chip">Lista t√∂rl√©se</button>
      </div>

      <!-- Summary stat -->
      <div id="summary" class="stat mb-3">
        <div class="flex items-center justify-between text-sm">
          <div class="flex-1">
            <div class="text-slate-500">Sp√≥rolt √∂sszesen</div>
            <div id="sumSaved" class="font-bold text-green-600 tabular-nums">0 Ft</div>
          </div>
          <div class="w-px h-8 bg-slate-200 mx-3"></div>
          <div class="flex-1">
            <div class="text-slate-500">Elk√∂lt√∂tt √∂sszesen</div>
            <div id="sumBought" class="font-bold text-red-600 tabular-nums">0 Ft</div>
          </div>
        </div>
        <div class="mt-2 text-sm">
          <span class="text-slate-500">Egyenleg:</span>
          <span id="sumNet" class="font-semibold">0 Ft</span>
        </div>
      </div>

      <ul id="resultList" class="divide-y divide-slate-100"></ul>

      <!-- Quick add row -->
      <div class="mt-4 p-3 rounded-xl" style="background:#f8fafc; border:1px dashed #e2e8f0">
        <p class="text-sm font-semibold mb-2">Gyors hozz√°ad√°s</p>
        <div class="grid grid-cols-2 gap-2">
          <input id="quickName" type="text" class="input" placeholder="Term√©k">
          <input id="quickPrice" type="number" class="input" placeholder="√År (Ft)">
        </div>
        <div class="flex gap-2 mt-2">
          <button id="quickAddSave" class="btn btn-good flex-1">+ Sp√≥roltam</button>
          <button id="quickAddBuy"  class="btn btn-bad flex-1">+ Vettem</button>
        </div>
      </div>

      <div class="flex justify-end mt-3">
        <button id="backToCalc" class="btn btn-secondary">Vissza a sz√°mol√≥hoz</button>
      </div>
    </section>

  </main>

  <!-- MODAL -->
  <div id="modal" class="hidden fixed inset-0 bg-black/50 z-50">
    <div class="min-h-full flex items-center justify-center p-4">
      <div class="w-full max-w-sm card">
        <h3 class="text-lg font-bold mb-2">Ejnye‚Ä¶</h3>
        <p id="modalText" class="mb-4"></p>
        <div class="text-right">
          <button id="closeModal" class="btn btn-accent">Ok√© üòÖ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    const qs = (s)=>document.querySelector(s);
    const fmtFt = (v)=> new Intl.NumberFormat('hu-HU',{ style:'currency', currency:'HUF', maximumFractionDigits:0}).format(Number(v||0));
    const showOnly = (id)=> {
      ['welcome','profile','calc','results'].forEach(x=>qs('#screen-'+x).classList.add('hidden'));
      qs('#screen-'+id).classList.remove('hidden');
      window.scrollTo({top:0, behavior:'smooth'});
    };

    // ---------- Storage ----------
    const getProfile = ()=> JSON.parse(localStorage.getItem('profile')||'null');
    const setProfile = (obj)=> localStorage.setItem('profile', JSON.stringify(obj));
    const getItems = ()=> JSON.parse(localStorage.getItem('results')||'[]');
    const setItems = (arr)=> localStorage.setItem('results', JSON.stringify(arr));

    // ---------- App state ----------
    let latestCalc = null; // { name, price, hours, hourly }

    // ---------- UI el√©r√©sek ----------
    const el = {
      // nav
      brandTitle: qs('#brandTitle'),
      helloNick: qs('#helloNick'),
      goCalc: qs('#goCalc'),
      goResults: qs('#goResults'),
      goProfile: qs('#goProfile'),
      // welcome
      startBtn: qs('#startBtn'),
      // profile
      nick: qs('#nick'),
      age: qs('#age'),
      salary: qs('#salary'),
      hours: qs('#hours'),
      saveProfile: qs('#saveProfile'),
      cancelProfile: qs('#cancelProfile'),
      // calc
      productName: qs('#productName'),
      productPrice: qs('#productPrice'),
      calculateBtn: qs('#calculateBtn'),
      calcBox: qs('#calcBox'),
      workResult: qs('#workResult'),
      workSub: qs('#workSub'),
      saveBtn: qs('#saveBtn'),
      buyBtn: qs('#buyBtn'),
      // results
      resultList: qs('#resultList'),
      clearList: qs('#clearList'),
      quickName: qs('#quickName'),
      quickPrice: qs('#quickPrice'),
      quickAddSave: qs('#quickAddSave'),
      quickAddBuy: qs('#quickAddBuy'),
      backToCalc: qs('#backToCalc'),
      sumSaved: qs('#sumSaved'),
      sumBought: qs('#sumBought'),
      sumNet: qs('#sumNet'),
      // modal
      modal: qs('#modal'),
      modalText: qs('#modalText'),
      closeModal: qs('#closeModal'),
    };

    // ---------- √úzenetek (100+) ----------
    const messages = [
      "Ejha, ennyit mel√≥zni ez√©rt? üòÖ",
      "Rem√©lem, t√©nyleg meg√©rte!",
      "A lelkiismereted most elment k√°v√©zni.",
      "Ez f√°jni fog h√≥ v√©g√©n.",
      "Legal√°bb sz√©p lesz.",
      "K√©ne hozz√° egy fizet√©semel√©s is‚Ä¶",
      "B√°tor d√∂nt√©s, kapit√°ny!",
      "Egy szabadnap √°ra sim√°n elment.",
      "√âlvezd minden forintj√°t!",
      "M√°sodik √°ll√°s is j√°tszik? üôÉ",
      "Au. A p√©nzt√°rc√°d megs√©rt≈ëd√∂tt.",
      "A banksz√°ml√°d m√©ly leveg≈ët vett.",
      "A j√∂v≈ëbeli √©ned most cs√≥v√°lja a fej√©t.",
      "A kalkul√°tor s√≠rva k√©r bocs√°natot.",
      "A zsebed most di√©t√°zik.",
      "Sz√≠vd fel, ez m√°r committed. üí∏",
      "Nem minden h≈ës visel k√∂penyt. N√©melyik hitelk√°rty√°t.",
      "A racionalit√°s most elment eb√©delni.",
      "A megtakar√≠t√°sod most offline.",
      "Legal√°bb lesz mit posztolni.",
      "K√©rj sz√°ml√°t, f√°jni fog eml√©k n√©lk√ºl.",
      "Ha √∂r√∂m√∂t hoz, meg√©rte. Ha porosodik, kev√©sb√©.",
      "A munkaid≈ëd tapssal k√≠s√©rte a d√∂nt√©st.",
      "Ez is egy √©let√∫t.",
      "Az infl√°ci√≥ tapsol a partvonalr√≥l.",
      "A minimalizmus most felmondott.",
      "A k√©s≈ëbbi √©n: ‚Äûugye haszn√°ltad is?‚Äù",
      "A p√©nz√ºgyi tan√°csad√≥d ghostol.",
      "Ez a v√°s√°rl√°s k√°v√©ban m√©rve sok.",
      "A f≈ën√∂k√∂d most b√ºszke lenne‚Ä¶ vagy nem.",
      "Az √©rt√©k: k√©tes. Az √©rz√©s: dr√°ga.",
      "A v√°gy gy≈ëz√∂tt a j√≥zan √©sz felett.",
      "Kinek kell nyaral√°s, ha van ez is?",
      "A kassza: *critical hit*.",
      "A sp√≥rol√°s: AFK.",
      "A felel≈ëss√©g: ‚Äûmost nem √©rek r√°‚Äù.",
      "Be√°ldozt√°l p√°r Netflix-est√©t munk√°ra.",
      "Eg√©szs√©gedre‚Ä¶ a k√∂lt√©sedre.",
      "Kock√°zatos? Igen. Men≈ë? Tal√°n.",
      "Ez az √©lm√©ny √°rban pr√©mium.",
      "Kipip√°ltad a dr√°ga d√∂nt√©s bingo-t.",
      "A FOMO hangosan tapsolt.",
      "Egyszer √©l√ºnk ‚Äì a banksz√°mla szerint k√©tszer fizet√ºnk.",
      "Ha haszn√°lod, meg√©rte. Ha nem, tr√≥fea lett.",
      "Ez m√°r nem impulzus, ez rom√°nc.",
      "A hiteled: nem p√©nz√ºgyi √©rtelemben n≈ëtt.",
      "Mennyi √≥r√°t √©r meg a mosoly?",
      "A kalkul√°tor: ‚Äûmondd, hogy legal√°bb akci√≥s volt!‚Äù",
      "A munkab√©r: ‚Äû√©n ez√©rt dolgoztam?‚Äù",
      "A c√©ljaid most √∫jrasz√°molnak.",
      "Napt√°r: √∫j bejegyz√©s ‚Äì ‚Äût√∂bbet dolgozni‚Äù.",
      "A d√∂nt√©sed 10+ √≥r√°s film hossz√∫.",
      "K√°v√©t f≈ëzz, ez hossz√∫ menet lesz.",
      "A sp√≥rol√≥persely s√≠rva n√©z.",
      "A tudatoss√°g most vak√°ci√≥zik.",
      "Ez a ‚Äûmost vagy soha‚Äù el√©g dr√°ga volt.",
      "Kapt√°l √©rte √∂r√∂m√∂t? Remek. Sz√°ml√°t? M√©g jobb.",
      "Sz√©p, csillog, dr√°ga ‚Äì mint a d√∂nt√©sed.",
      "A p√©nzt√°rc√°d kifek√ºdt a kanap√©ra.",
      "A j√©ghideg zuhany a h√≥ v√©g√©n j√∂n.",
      "Extra √≥r√°k incoming.",
      "Szeresd. Mert sok munka√≥ra szeretne viszontl√°tni.",
      "A j√∂v≈ëbeli te: ‚Äûna j√≥, legyen, csak haszn√°ld‚Äù.",
      "Minimum 10 √≥ra ‚Äì maximum rem√©ny.",
      "A boldogs√°g √°ra: pontosan ennyi.",
      "Ez a ‚Äûmeg√©rdemlem‚Äù deluxe csomagja.",
      "A racionalit√°s √ºzenete: ‚Äûvisszah√≠vjuk.‚Äù",
      "Ha √©rt√©ket hoz, szent. Ha porosodik, b≈±n.",
      "A k√∂lts√©gvet√©s most ny√∫jt√≥zik.",
      "A minimalista sz√≠ved most kihagyott egy √ºtemet.",
      "Sz√°molj: mosoly/√≥ra ar√°ny.",
      "Tudatos k√∂lt√©s? Most ink√°bb tudatos ut√≥lagoss√°g.",
      "J√°r a pacsi ‚Äì √©s a t√∫l√≥ra.",
      "Ha √∂r√∂met hoz, ne b√°nk√≥dj. Ha st√°tuszt, gondold √°t.",
      "Ez a ‚Äûtreat yourself‚Äù XL verzi√≥.",
      "A p√©nz id≈ë ‚Äì most sok id≈ë ment p√©nzbe.",
      "A k√∂lt√©sed most influencer lenne.",
      "Aj√°nd√©k magadnak ‚Äì a sz√°mla is az.",
      "Dr√°ga lecke vagy √©rt√©kes befektet√©s?",
      "A sp√≥rol√°si c√©lod kicsit od√©bb k√∂lt√∂z√∂tt.",
      "A realit√°s csendben integet.",
      "Az √≥rab√©red megszomorodott.",
      "Az √©lm√©ny √°ra: kimondva f√°j, haszn√°latban gy√≥gy√≠t.",
      "A ‚Äûmajd holnap sp√≥rolok‚Äù ma valut√°t v√°ltott.",
      "Egy kis b≈±ntudat j√°r mell√©, ingyen.",
      "Ha a sz√≠vedet szolg√°lja, ok√©. Ha az eg√≥d, dr√°ga.",
      "A bank appod push √©rtes√≠t√©st √≠rt: ‚Äûejnye‚Äù.",
      "Ha legal√°bb akci√≥s volt, kev√©sb√© f√°j.",
      "A d√∂nt√©s megt√∂rt√©nt, a p√©nz elment, az √©rt√©k maradjon.",
      "L√©gy kedves a j√∂v≈ëbeli √©nedhez ‚Äì haszn√°ld!",
      "A sp√≥rolt c√©lok most √°tmenetileg sz√ºnetelnek.",
      "Ez a luxus a mindennapok tetej√©n √ºl.",
      "A p√©nz√ºgyi tudatoss√°g most csendre v√°ltott.",
      "A ‚Äûcsak egyszer √©l√ºnk‚Äù addig j√≥, am√≠g k√©tszer nem fizetsz.",
      "A kassza: ‚Äûk√∂szi az adom√°nyt‚Äù.",
      "Az √∂r√∂m-indexed rem√©lhet≈ëleg emelkedik.",
      "A d√∂nt√©sed val√≥sz√≠n≈±leg gy√∂ny√∂r≈± ‚Äì √©s k√∂lts√©ges.",
      "A kalkul√°tor be√≠rta: ‚Äûhuh‚Äù.",
      "Az excel t√°bl√°d most fintorog.",
      "A munka√≥ra-sz√°ml√°l√≥ megszaladt.",
      "A lelkiismeret: ‚Äûbesz√©lj√ºnk holnap‚Äù.",
      "A c√©ljaid: ‚Äûegy kicsit k√©s≈ëbb‚Äù.",
      "A p√©nzt√°rca: ‚Äûma pihenek‚Äù.",
      "Ez a d√∂nt√©s piros bet≈±vel ker√ºlt a napt√°rba.",
      "Ha √©rt√©ket termel, minden ok√©.",
      "A hezit√°l√°s dr√°ga ‚Äì a d√∂nt√©s m√©g dr√°g√°bb.",
      "A sp√≥rol√°si cs√≠k most visszafel√© k√∫szott.",
      "A te id≈ëd arany ‚Äì most t√©nyleg azz√° v√°lt.",
      "A FOMO most nyert, a p√©nzt√°rca vesz√≠tett.",
      "Ez egy ‚Äût√∂bb munka, ugyanannyi √∂r√∂m?‚Äù-t√≠pus√∫ d√∂nt√©s.",
      "Ha mosolyogsz t≈ële, rendben vagyunk.",
      "A j√≥zan √©sz most csendben figyel.",
      "A c√©lt√°bla √°t√°llt: ‚Äû√©lm√©ny‚Äù m√≥d.",
      "A p√©nz√ºgyi coachod most m√©ly leveg≈ët vett.",
      "A munka√≥ra-kalkul√°tor tapsol‚Ä¶ idegesen.",
      "Ha kihaszn√°lod, ok√©. Ha dobozban marad, ejnye.",
      "A d√∂nt√©sed t√∂rt√©netet mes√©l ‚Äì csak dr√°g√°t."
    ];
    // 100+ √ºzenet (110 felett)

    // ---------- Init ----------
    function init(){
      // Nav
      el.goCalc.addEventListener('click', ()=> showOnly('calc'));
      el.goResults.addEventListener('click', ()=> { renderList(); showOnly('results'); });
      el.goProfile.addEventListener('click', ()=> {
        const p = getProfile();
        if(p){
          el.nick.value   = p.nick || '';
          el.age.value    = p.age  || '';
          el.salary.value = p.salary || '';
          el.hours.value  = p.hours || '';
        }
        showOnly('profile');
      });

      // Welcome
      el.startBtn.addEventListener('click', ()=>{
        const p = getProfile();
        if(!p){ showOnly('profile'); } else { showOnly('calc'); }
      });

      // Profile save/cancel
      el.saveProfile.addEventListener('click', ()=>{
        const nick = (el.nick.value||'').trim();
        const age  = Number(el.age.value);
        const s    = Number(el.salary.value);
        const h    = Number(el.hours.value);
        if(!nick || !age || !s || !h || age<=0 || s<=0 || h<=0){
          alert('K√©rlek, t√∂lts ki minden mez≈ët √©rv√©nyes √©rt√©kkel.');
          return;
        }
        setProfile({ nick, age, salary:s, hours:h });
        applyGreeting();
        showOnly('calc');
      });
      el.cancelProfile.addEventListener('click', ()=>{
        const p = getProfile();
        if(p){ showOnly('calc'); } else { showOnly('welcome'); }
      });

      // Calculator
      el.calculateBtn.addEventListener('click', doCalculate);
      el.saveBtn.addEventListener('click', ()=> decide('save'));
      el.buyBtn.addEventListener('click',  ()=> decide('buy'));

      // Results
      el.clearList.addEventListener('click', ()=>{
        if(confirm('Biztos t√∂rl√∂d az √∂sszes elemet?')){ setItems([]); renderList(); }
      });
      el.backToCalc.addEventListener('click', ()=> showOnly('calc'));
      el.quickAddSave.addEventListener('click', ()=> quickAdd('save'));
      el.quickAddBuy.addEventListener('click',  ()=> quickAdd('buy'));

      // Modal
      el.closeModal.addEventListener('click', ()=> el.modal.classList.add('hidden'));

      // Start screen
      const p = getProfile();
      applyGreeting();
      if(p){ showOnly('calc'); } else { showOnly('welcome'); }
      renderList();
    }

    function applyGreeting(){
      const p = getProfile();
      if(p && p.nick){
        el.brandTitle.textContent = `Szia, ${p.nick} üëã`;
        el.helloNick.textContent  = `${p.nick}, k√©szen √°llsz?`;
      }else{
        el.brandTitle.textContent = 'Munka√≥ra';
        el.helloNick.textContent  = '';
      }
    }

    function doCalculate(){
      const name = (el.productName.value || '').trim();
      const price = Number(el.productPrice.value);
      const p = getProfile();
      if(!p){ alert('El≈ëbb add meg a profilod!'); showOnly('profile'); return; }
      if(!name || !price){ alert('Add meg a term√©k nev√©t √©s √°r√°t.'); return; }

      const hourly = p.salary / (p.hours * 4); // egyszer≈± k√∂zel√≠t√©s
      const hours = price / hourly;
      latestCalc = { name, price, hours, hourly };

      el.workResult.textContent = `Ez kb. ${hours.toFixed(1)} munka√≥r√°dba ker√ºlne.`;
      el.workSub.textContent = `${name} √°ra: ${fmtFt(price)} ‚Ä¢ √ìrab√©red ~ ${fmtFt(hourly)}`;
      el.calcBox.classList.remove('hidden');
    }

    function decide(type){
      if(!latestCalc){ return; }
      const items = getItems();
      items.unshift({
        id: Date.now(),
        name: latestCalc.name,
        price: latestCalc.price,
        type
      });
      setItems(items);
      renderList();
      showOnly('results');

      // Modal, ha > 10 √≥ra √©s ‚ÄûMegveszem‚Äù
      if(type === 'buy' && latestCalc.hours > 10){
        const msg = messages[Math.floor(Math.random()*messages.length)];
        el.modalText.textContent = msg;
        el.modal.classList.remove('hidden');
      }

      // reset calculator inputs + box
      el.productName.value = '';
      el.productPrice.value = '';
      el.calcBox.classList.add('hidden');
      latestCalc = null;
    }

    function quickAdd(type){
      const name = (el.quickName.value||'').trim();
      const price = Number(el.quickPrice.value);
      if(!name || !price){ alert('Adj meg nevet √©s √°rat.'); return; }
      const items = getItems();
      items.unshift({ id: Date.now(), name, price, type });
      setItems(items);
      el.quickName.value = '';
      el.quickPrice.value = '';
      renderList();
    }

    function removeItem(id){
      const items = getItems().filter(x=>x.id !== id);
      setItems(items);
      renderList();
    }

    function renderList(){
      const list = getItems();

      // √ñsszegz√©s sz√°m√≠t√°sa
      const totalSaved  = list.filter(x=>x.type==='save').reduce((s,x)=>s+x.price,0);
      const totalBought = list.filter(x=>x.type==='buy').reduce((s,x)=>s+x.price,0);
      const net = totalSaved - totalBought;

      el.sumSaved.textContent  = fmtFt(totalSaved);
      el.sumBought.textContent = fmtFt(totalBought);
      el.sumNet.textContent    = `${net>=0?'+':''}${fmtFt(net)}` + (net>=0?' el≈ënyben üéâ':' m√≠nuszban üôà');
      el.sumNet.className = 'font-semibold ' + (net>=0? 'text-green-600':'text-red-600');

      // Lista kirajzol√°sa
      el.resultList.innerHTML = '';
      if(list.length === 0){
        el.resultList.innerHTML = `
          <li class="py-6 text-center text-slate-500">
            M√©g nincs t√©tel. Vedd fel a sz√°mol√≥val, vagy haszn√°ld a gyors hozz√°ad√°st.
          </li>`;
        return;
      }
      for(const it of list){
        const row = document.createElement('li');
        const color = it.type === 'buy' ? 'text-red-600' : 'text-green-600';
        const badge = it.type === 'buy' ? 'VETTEM' : 'SP√ìROLTAM';
        row.className = 'py-3 flex items-center justify-between';
        row.innerHTML = `
          <div class="flex flex-col">
            <span class="font-semibold ${color}">${escapeHtml(it.name)}</span>
            <span class="text-xs text-slate-500">${badge}</span>
          </div>
          <div class="flex items-center gap-3">
            <span class="tabular-nums font-semibold">${fmtFt(it.price)}</span>
            <button aria-label="T√∂rl√©s" class="chip hover:bg-red-50 hover:text-red-600" data-del="${it.id}">‚ùå</button>
          </div>`;
        el.resultList.appendChild(row);
      }
      // t√∂rl√©s handler
      el.resultList.querySelectorAll('[data-del]').forEach(btn=>{
        btn.addEventListener('click', ()=> removeItem(Number(btn.getAttribute('data-del'))));
      });
    }

    function escapeHtml(str){ return str.replace(/[&<>'"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;'}[c])); }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
